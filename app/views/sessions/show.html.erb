<% provide(:title, 'Results') %>

<div id="results">
	
	<h2>Results</h2>
	
	<% #Number Correct %>
	<p class="results-text">You selected <strong><%= "#{@session.trials.where(task_success: true).count}"%> out of 24</strong> icons correctly<br />with an average speed of <strong><%= "#{(@session.trials.average("task_time") / 1000).round(3)}" %> seconds</strong>.</p>
	
	<% #Percentile Score %>
	<p class="results-text">You were faster than <strong>90%</strong> of all other participants.</p>

	<% #Fastest Trials %>
	<div class="superlative-trial fastest">
		<h3>Fastest Trials</h3>
		<div class="fastest-trial trial">
			<%= image_tag("form#{@fastest[0].target_form}-#{@fastest[0].style}-#{@fastest[0].color}.png") %>
			<p><strong><%= "#{@fastest[0].task_time.to_f / 1000}"%></strong> seconds
			<br />
			<span class="superlative">FASTEST</span></p>
		</div>
		<% i = 1 %>
		<% 4.times do %>
		<div class="trial">
			<%= image_tag("form#{@fastest[i].target_form}-#{@fastest[i].style}-#{@fastest[i].color}.png") %>
			<p><strong><%= "#{@fastest[i].task_time.to_f / 1000}"%></strong> sec
			</p>
		</div>
		<% i += 1 %>
		<% end %>
	</div>
	
	<% #Slowest Trials %>
	<div class="superlative-trial slowest">
		<h3>Slowest Trials</h3>
		<div class="slowest-trial trial">
			<%= image_tag("form#{@slowest[0].target_form}-#{@slowest[0].style}-#{@slowest[0].color}.png") %>
			<p><strong><%= "#{@slowest[0].task_time.to_f / 1000}"%></strong> seconds
			<br />
			<span class="superlative">SLOWEST</span></p>
			</p>
		</div>
		<% i = 1 %>
		<% 4.times do %>
		<div class="trial">
			<%= image_tag("form#{@slowest[i].target_form}-#{@slowest[i].style}-#{@slowest[i].color}.png") %>
			<p><strong><%= "#{@slowest[i].task_time.to_f / 1000}"%></strong> sec
			</p>
		</div>
		<% i += 1 %>
		<% end %>
	</div>

	<% #Filter Results %>
	<div class="filter-results">
		<h3>Filter Results</h3>
		
		<div class="filter-select">
			<p class="filters">

				Show average 
				
				<%= select_tag :speed_accuracy, options_for_select([
					['speed', 'speed'],
					['accuracy', 'accuracy']]),:class => 'multiselect' %>
				
				for icons with 
				
				<%= select_tag :style, options_for_select([
					['either', 'either'],
					['solid', 'solid'],
					['hollow', 'hollow']]),:class => 'multiselect' %>
				
				style and 
				
				 <%= select_tag :color, options_for_select([
				 	['either', 'either'],
				 	['black on white', 'white_bg'],
				 	['white on black', 'black_bg']]),:class => 'multiselect' %>
				 
				color
			</p>
		</div>

		<div class="group1 grey-bg">
			<p class="for">For</p>
			<div>
				<%= radio_button_tag :group1, 'me', true, class: 'group1-input me'  %>
				<%= label_tag :group1_me, 'Me'  %>
				<%= radio_button_tag :group1, 'all-people', false, class: 'group1-input all-people'  %>
				<%= label_tag 'group1_all-people', 'All people', class: 'all-people-label'  %>
					<span class="elipses">...</span>
			</div>
			<div class="group1-filter hidden">
				
				<p class="filters">

					<%= select_tag :group1_age, options_for_select([
						['of all ages', 'all'],
						['between 18-25', '18-25'],
						['between 26-40', '26-40'],
						['between 41-60', '41-60'],
						['older than 60', '60_older']
					]),:class => 'multiselect' %>
					
					who took this test using
					
					<%= select_tag :group1_test_browser, options_for_select([
						['any browser', 'any'],
						["Chrome","chrome"],
						["Safari","safari"],
						["Firefox","firefox"],
						["IE","ie"],
						["Opera","opera"],
						["other browser","other"]
					]),:class => 'multiselect' %>

					from
					
					<%= select_tag :group1_test_os, options_for_select([
						['any computer', 'any'],
						["Windows computer","ios"],
						["Mac computer","android"],
						["Linux computer","linux"],
						["other computer","other"]
					]),:class => 'multiselect' %>

					who are most comfortable using 
					
					<%= select_tag :group1_primary_os, options_for_select([
						['any desktop OS', 'any'],
						["Windows","windows"],
						["Mac","mac"],
						["Linux","linux"],
						["other desktop OS","other"]
					]),:class => 'multiselect' %>

					and
					
					<%= select_tag :group1_primary_mobile, options_for_select([
						['any mobile OS', 'any'],
						["iPhone/iOS","ios"],
						["Android","android"],
						["Windows Mobile","windows-mobile"],
						["BlackBerry","blackberry"],
						["other mobile OS","other"]
					]),:class => 'multiselect' %>
					
			 	</p>
			</div>
		</div>
		
		<div class="group1-label group-label hidden">
				<span>GROUP 1</span>
		</div>

		
		<div class="compared-to">
			<p>Compared to<span class="caret"></span></p>
		</div>
		
		<div class="group2-filter grey-bg hidden">
			<p class="filters">

					All people

					<%= select_tag :group2_age, options_for_select([
						['of all ages', 'all'],
						['between 18-25', '18-25'],
						['between 26-40', '26-40'],
						['between 41-60', '41-60'],
						['older than 60', '60_older']
					]),:class => 'multiselect' %>
					
					who took this test using
					
					<%= select_tag :group2_test_browser, options_for_select([
						['any browser', 'any'],
						["Chrome","chrome"],
						["Safari","safari"],
						["Firefox","firefox"],
						["IE","ie"],
						["Opera","opera"],
						["other browser","other"]
					]),:class => 'multiselect' %>

					from
					
					<%= select_tag :group2_test_os, options_for_select([
						['any computer', 'any'],
						["Windows computer","ios"],
						["Mac computer","android"],
						["Linux computer","linux"],
						["other computer","other"]
					]),:class => 'multiselect' %>

					who are most comfortable using 
					
					<%= select_tag :group2_primary_os, options_for_select([
						['any desktop OS', 'any'],
						["Windows","windows"],
						["Mac","mac"],
						["Linux","linux"],
						["other desktop OS","other"]
					]),:class => 'multiselect' %>

					and
					
					<%= select_tag :group2_primary_mobile, options_for_select([
						['any mobile OS', 'any'],
						["iPhone/iOS","ios"],
						["Android","android"],
						["Windows Mobile","windows-mobile"],
						["BlackBerry","blackberry"],
						["other mobile OS","other"]
					]),:class => 'multiselect' %>
					
			 	</p>
		</div>

		<div class="group2-label group-label hidden">
			<span>GROUP 2</span>
		</div>
		
		<div id="chart-container"></div>

	</div>
</div>

<script type='text/javascript'>
	$(document).ready(function() {

	  console.log("results.js working");
	  console.log("the average time for solid trials is " + "<%= (@session.trials.where(style:'solid').average('task_time').to_f / 1000).round(3) %>");

		var cats = ["Solid Black","Hollow Black","Solid White","Hollow White"];
		var group1_series = {name: 'Group 1', data: [<%= (@session.trials.where(style:'solid').average('task_time').to_f / 1000).round(3) %>, 0, 4, 5]};
		var group2_series = {name: 'Group 2', data: [5, 7, 3, 5]};
		
		if ($('.group2-filter').hasClass('hidden')) {
			var series_visible = [group1_series];
		} else {
			var series_visible = [group1_series, group2_series];
		};	

		var chart = new Highcharts.Chart({
			chart: {
				type: 'column',
				renderTo: 'chart-container'
			},
			title: {
				text: 'Speed'
			},
			xAxis: {
				categories: cats,
				title: {
					text: "Style/Color Combinations"
				}
			},
			yAxis: {
				type: "linear",
				title: {
					text: "Time"
				}
			},
			series: series_visible,
			colors: [
			   '#00bcdf',
			   '#ed145b'
			],
			credits: {
				enabled: false
			}
		});

		//Expand and Contract Group 1 Filters
		$('.group1-input').click(function() {
			console.log("clicked");
			if ($('.all-people').is(':checked')){
	      $('.group1-filter').removeClass('hidden');
	      $('span.elipses').addClass('hidden');
	    }
	    else {
				$('.group1-filter').addClass('hidden');
				$('span.elipses').removeClass('hidden');
	    }
	  });

		//Expand and Contract Group 2 Filters
		$('.compared-to').mouseup(function() {
	  	if ($('.group2-filter').hasClass('hidden')) {
	  		$('.group1-label').removeClass('hidden');
	  		$('.group2-filter').removeClass('hidden');
	  		$('.group2-label').removeClass('hidden');
	  		$('.compared-to').addClass('grey-bg');
				chart.addSeries(group2_series);
			} else {
				$('.group2-filter').addClass('hidden');
				$('.group1-label').addClass('hidden');
				$('.group2-label').addClass('hidden');
				$('.compared-to').removeClass('grey-bg');
				chart.series[1].remove();
			}
		});
	});
</script>